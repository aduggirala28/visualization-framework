{
    "author": "Ryan Fredette",
    "id": "inf-bed-regress-counts",
    "query": {
        "body": {
            "_source": {
                "excludes": []
            },
            "aggs": {
                "testbed": {
                    "aggs": {
                        "total_jobs": {
                            "cardinality": {
                                "field": "job_id"
                            }
                        }
                    },
                    "terms": {
                        "field": "testbed",
                        "order": {
                            "total_jobs   ": "asc"
                        },
                        "size": 50
                    }
                }
            },
            "query": {
                "bool": {
                    "filter": [
                        {
                            "wildcard": {
                                "version.vrs": "{{vrsVersion}}"
                            }
                        },
                        {
                            "wildcard": {
                                "version.vsc": "{{vscVersion}}"
                            }
                        },
                        {
                            "wildcard": {
                                "version.vsd": "{{vsdVersion}}"
                            }
                        },
                        {
                            "wildcard": {
                                "testbed": "*{{bedType}}*"
                            }
                        }
                    ],
                    "must": [
                        {
                            "range": {
                                "time_regression_submitted": {
                                    "format": "epoch_millis",
                                    "gte": "{{startTime:now-24h}}",
                                    "lte": "{{endTime:now}}"
                                }
                            }
                        }
                    ],
                    "must_not": [
                        {
                            "match_phrase": {
                                "testsuite": "Sanity"
                            }
                        },
                        {
                            "match_phrase": {
                                "testsuite": "sanity"
                            }
                        },
                        {
                            "match_phrase": {
                                "testsuite": "initial"
                            }
                        },
                        {
                            "match_phrase": {
                                "testsuite": "final"
                            }
                        },
                        {
                            "match_phrase": {
                                "testsuite": "finished"
                            }
                        }
                    ]
                }
            },
            "size": 0,
            "sort": [
                {
                    "time_regression_started": {
                        "order": "desc"
                    }
                }
            ]
        },
        "index": "nuage_regress",
        "type": "nuage_doc_type"
    },
    "service": "elasticsearch",
    "tabify": "infraRegressionCount"
}
